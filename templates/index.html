<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>水龙头自动领取</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    textarea { width: 100%; height: 100px; }
    #output { white-space: pre-wrap; background: #f4f4f4; padding: 10px; border: 1px solid #ccc; margin-top: 20px; height: 300px; overflow-y: scroll; }
  </style>
</head>
<body>
  <h1>水龙头自动领取</h1>
  <form onsubmit="start(event)">
    <label>钱包地址 (每行一个):</label><br>
    <textarea id="addresses"></textarea><br>
    <label>Socks5代理 (每行一个):</label><br>
    <textarea id="proxies"></textarea><br>
    <label>YesCaptcha API Key:</label><br>
    <input id="client_key" style="width: 100%;" /><br><br>
    <button type="submit">开始领取</button>
  </form>
  <div id="output"></div>

  <script>
    function start(event) {
      event.preventDefault();
      const addrs = document.getElementById("addresses").value.trim();
      const proxies = document.getElementById("proxies").value.trim();
      const key = document.getElementById("client_key").value.trim();
      if (!addrs || !proxies || !key) return alert("请填写所有字段");

      const params = new URLSearchParams();
      params.append("addresses", addrs);
      params.append("proxies", proxies);
      params.append("client_key", key);

      const evtSource = new EventSource("/run?" + params.toString().replace(/\n/g, "%0A"));
      const output = document.getElementById("output");
      output.innerText = "开始领取...\n";

      evtSource.onmessage = e => output.innerText += e.data + "\n";
      evtSource.onerror = () => {
        output.innerText += "\n❌ 流连接中断或出错。\n";
        evtSource.close();
      };
    }
  </script>
</body>
</html>
