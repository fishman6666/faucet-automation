<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>批量领取</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
    textarea, input { width: 100%; margin-top: 10px; }
    #output { white-space: pre-wrap; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>批量领取工具</h2>
  <form id="mainForm">
    <label>钱包地址（每行一个）:</label><br>
    <textarea id="addresses" rows="5"></textarea><br>
    <label>代理列表（ip:port:user:pass）:</label><br>
    <textarea id="proxies" rows="5"></textarea><br>
    <label>YesCaptcha API Key:</label><br>
    <input id="clientKey"><br>
    <button type="submit">开始领取</button>
  </form>
  <div id="output"></div>
  <script>
    document.getElementById("mainForm").onsubmit = function(e) {
      e.preventDefault();
      const addresses = document.getElementById("addresses").value;
      const proxies = document.getElementById("proxies").value;
      const clientKey = document.getElementById("clientKey").value;
      const output = document.getElementById("output");
      output.textContent = "开始连接...\n";

      // 用POST发FormData
      const formData = new FormData();
      formData.append("addresses", addresses);
      formData.append("proxies", proxies);
      formData.append("client_key", clientKey);

      const evtSource = new EventSourcePolyfill('/run-evt?' + new URLSearchParams({
        addresses, proxies, client_key: clientKey
      }).toString(), {withCredentials:false});

      // 如果服务端支持POST SSE，可以用 fetch+ReadableStream; 否则polyfill fallback GET
      evtSource.onmessage = function(e) {
        output.textContent += e.data + "\n";
        if (e.data.includes("领取成功")) {
          output.textContent += "🎉 领取完成！\n";
        }
      };
      evtSource.onerror = function(e) {
        output.textContent += "❌ 流连接中断或出错。\n";
        evtSource.close();
      };
    }
  </script>
  <!-- 如果服务端没做POST SSE Polyfill, 可删掉 Polyfill 用原生EventSource并用GET（或根据你实际后端GET/POST策略切换） -->
</body>
</html>
