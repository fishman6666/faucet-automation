<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>æ‰¹é‡é¢†å–</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
    textarea, input { width: 100%; margin-top: 10px; }
    #output { white-space: pre-wrap; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>æ‰¹é‡é¢†å–å·¥å…·</h2>
  <form id="mainForm">
    <label>é’±åŒ…åœ°å€ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰:</label><br>
    <textarea id="addresses" rows="5"></textarea><br>
    <label>ä»£ç†åˆ—è¡¨ï¼ˆip:port:user:passï¼‰:</label><br>
    <textarea id="proxies" rows="5"></textarea><br>
    <label>YesCaptcha API Key:</label><br>
    <input id="clientKey"><br>
    <button type="submit">å¼€å§‹é¢†å–</button>
  </form>
  <div id="output"></div>
  <script>
    document.getElementById("mainForm").onsubmit = function(e) {
      e.preventDefault();
      const addresses = document.getElementById("addresses").value;
      const proxies = document.getElementById("proxies").value;
      const clientKey = document.getElementById("clientKey").value;
      const output = document.getElementById("output");
      output.textContent = "å¼€å§‹è¿æ¥...\n";

      // ç”¨POSTå‘FormData
      const formData = new FormData();
      formData.append("addresses", addresses);
      formData.append("proxies", proxies);
      formData.append("client_key", clientKey);

      const evtSource = new EventSourcePolyfill('/run-evt?' + new URLSearchParams({
        addresses, proxies, client_key: clientKey
      }).toString(), {withCredentials:false});

      // å¦‚æœæœåŠ¡ç«¯æ”¯æŒPOST SSEï¼Œå¯ä»¥ç”¨ fetch+ReadableStream; å¦åˆ™polyfill fallback GET
      evtSource.onmessage = function(e) {
        output.textContent += e.data + "\n";
        if (e.data.includes("é¢†å–æˆåŠŸ")) {
          output.textContent += "ğŸ‰ é¢†å–å®Œæˆï¼\n";
        }
      };
      evtSource.onerror = function(e) {
        output.textContent += "âŒ æµè¿æ¥ä¸­æ–­æˆ–å‡ºé”™ã€‚\n";
        evtSource.close();
      };
    }
  </script>
  <!-- å¦‚æœæœåŠ¡ç«¯æ²¡åšPOST SSE Polyfill, å¯åˆ æ‰ Polyfill ç”¨åŸç”ŸEventSourceå¹¶ç”¨GETï¼ˆæˆ–æ ¹æ®ä½ å®é™…åç«¯GET/POSTç­–ç•¥åˆ‡æ¢ï¼‰ -->
</body>
</html>
